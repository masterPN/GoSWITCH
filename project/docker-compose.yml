version: '3'

services:

  esl-service:
    build:
      context: ./../esl-service
      dockerfile: ./../esl-service/esl-service.dockerfile
    restart: always
    deploy:
      mode: replicated
      replicas: 1
    extra_hosts:
      - "host.docker.internal:host-gateway"

  sql-service:
    build:
      context: ./../sql-service
      dockerfile: ./../sql-service/sql-service.dockerfile
    ports:
      - 8083:8080
    restart: always
    deploy:
      mode: replicated
      replicas: 1

  sql-server:
    image: mcr.microsoft.com/mssql/server:2022-latest
    user: root
    ports:
      - 8081:1433
    environment:
      - ACCEPT_EULA=Y
      - MSSQL_SA_PASSWORD=OneVois1
      - MSSQL_PID=Standard
    volumes:
      - ./../sql-server/data:/var/opt/mssql/data
      - ./../sql-server/log:/var/opt/mssql/log
      - ./../sql-server/secret:/var/opt/mssql/secrets

  redis-server:
    image: redis:latest
    restart: always
    ports:
      - 8082:6379
    environment:
      - REDIS_DISABLE_COMMANDS=FLUSHDB,FLUSHALL
    volumes:
      - ./../redis-server/data:/bitnami/redis/data
    